<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SBX Quote Builder</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React + ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    :root{
      --sbx-blue:#004aac;
      --sbx-text:#0f172a;
      --sbx-mute:#64748b;
      --sbx-bg:#f6f7fb;
      --card-min-h: 340px; /* equalised cards */
    }
    html,body{height:100%}
    body{
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background:var(--sbx-bg);
      color:var(--sbx-text);
    }
    .card{background:#fff;border-radius:16px;box-shadow:0 8px 24px rgba(2,6,23,0.08);min-height:var(--card-min-h)}
    .step-badge{
      display:inline-flex;align-items:center;gap:12px;
      padding:6px 14px;border-radius:999px;background:var(--sbx-blue);color:#fff;
      font-weight:800;font-size:14px;letter-spacing:.02em
    }
    .step-arrow{
      font-size:28px;line-height:1;color:#fff; /* high contrast inside the blue chip */
      transform: translateY(-1px);
    }
    input[type="checkbox"], input[type="radio"]{
      width:22px;height:22px;accent-color:var(--sbx-blue);cursor:pointer;
    }
    select, input[type="number"], input[type="text"], input[type="date"]{ font-size:15px; }
    /* hide arrows on mobile */
    @media (max-width: 1023px){
      .step-arrow{ display:none }
    }
    @media print{
      .no-print{display:none!important}
      .print-area{box-shadow:none!important;padding:0!important}
      body{background:#fff}
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const currency = n=>"£"+(Math.round(n*100)/100).toFixed(2);

    // Updated tiers (adds 250–350 and 350+)
    const REVENUE_TIERS=[
      {key:"u30",label:"Under £30k",min:0,max:30000,multiplier:1.00},
      {key:"30_90",label:"£30k – £90k",min:30000,max:90000,multiplier:1.10},
      {key:"90_150",label:"£90k – £150k",min:90000,max:150000,multiplier:1.20},
      {key:"150_250",label:"£150k – £250k",min:150000,max:250000,multiplier:1.35},
      {key:"250_350",label:"£250k – £350k",min:250000,max:350000,multiplier:1.45},
      {key:"350p",label:"£350k+",min:350000,max:Infinity,multiplier:1.60},
    ];

    // Arrow glyphs
    const AR = { right:"→", down:"↓", left:"←", up:"↑" };

    const Section = ({stepLabel, arrow, title, subtitle, children})=>(
      <div className="card p-6 h-full flex flex-col">
        <div className="mb-3 flex items-center justify-between">
          <span className="step-badge">
            Step&nbsp;{stepLabel}
            {arrow ? <span className="step-arrow">{AR[arrow]}</span> : null}
          </span>
        </div>
        <h2 className="text-xl font-semibold text-[var(--sbx-blue)]">{title}</h2>
        {subtitle && <p className="text-sm text-[var(--sbx-mute)] mt-1">{subtitle}</p>}
        <div className="mt-3 flex-1">{children}</div>
      </div>
    );

    function useIsDesktop() {
      const [isDesktop,setIsDesktop]=React.useState(() => window.matchMedia("(min-width:1024px)").matches);
      React.useEffect(()=>{
        const mq=window.matchMedia("(min-width:1024px)");
        const handler=()=>setIsDesktop(mq.matches);
        mq.addEventListener ? mq.addEventListener("change",handler) : mq.addListener(handler);
        return ()=> mq.removeEventListener ? mq.removeEventListener("change",handler) : mq.removeListener(handler);
      },[]);
      return isDesktop;
    }

    function useQuoteState(){
      const [step,setStep]=React.useState(1);

      // Entity
      const [who,setWho]=React.useState("limited"); // limited|partnership|individual|landlord
      const [companyType,setCompanyType]=React.useState("standard"); // standard|property (SPV)
      const [tierKey,setTierKey]=React.useState("30_90");
      const [isTrades,setIsTrades]=React.useState(false);
      const [dormant,setDormant]=React.useState(false);
      const [yearEnd,setYearEnd]=React.useState(""); // yyyy-mm-dd

      // Counts
      const [employees,setEmployees]=React.useState(1);      // includes directors on payroll
      const [spvProperties,setSpvProperties]=React.useState(1); // Ltd SPV properties
      const [personalProperties,setPersonalProperties]=React.useState(0); // landlord properties

      // Inclusions (monthly is standard; QB is standard)
      const [includePayroll,setIncludePayroll]=React.useState(true);     // 1–2 included by default
      const [includeBookkeeping,setIncludeBookkeeping]=React.useState(true);
      const [includeSingleSA,setIncludeSingleSA]=React.useState(true);   // untick → -£10/mo
      const [vatMonthly,setVatMonthly]=React.useState(false);            // controlled by tier defaults + user

      // Sole trader intent (business vs personal SA only)
      const [isSoleBusiness,setIsSoleBusiness]=React.useState(true);     // for who==="individual"
      const [saNonBusiness,setSaNonBusiness]=React.useState(false);      // personal SA only
      const [saSoleBusiness,setSaSoleBusiness]=React.useState(true);     // SA for business owner (default)

      // Bookkeeping support banding (partnership/individual)
      const [bkBand,setBkBand]=React.useState("none"); // none|low|med|high

      // Additional director SAs
      const [additionalDirectorSAs,setAdditionalDirectorSAs]=React.useState(0);

      // Trades / CIS split
      const [isCISContractor,setIsCISContractor]=React.useState(false);
      const [isCISSubcontractor,setIsCISSubcontractor]=React.useState(false);
      const [cisMonthlyReturns,setCisMonthlyReturns]=React.useState(false);
      const [cisSubbies,setCisSubbies]=React.useState(0);
      const [trackCISStatements,setTrackCISStatements]=React.useState(false); // free
      const [cisVerification,setCisVerification]=React.useState(true); // free (shown only as note)

      // Specialist
      const [ihtReview,setIhtReview]=React.useState(false);
      const [trustsWork,setTrustsWork]=React.useState(false);
      const [cgtWork,setCgtWork]=React.useState(false);
      const [propIncorpReview,setPropIncorpReview]=React.useState(false);
      const [p11d,setP11d]=React.useState(false);
      const [p11dEmployees,setP11dEmployees]=React.useState(1);
      const [dirPayOptimiser,setDirPayOptimiser]=React.useState(false); // free, hidden on individual/landlord

      // Defaults when dormant
      React.useEffect(()=>{
        if(dormant){
          setEmployees(0);
          setSpvProperties(0);
          setIncludePayroll(false);
          setIncludeBookkeeping(false);
          setIncludeSingleSA(false);
          setVatMonthly(false);
        }
      },[dormant]);

      // VAT default based on tier
      React.useEffect(()=>{
        const idx = REVENUE_TIERS.findIndex(t=>t.key===tierKey);
        setVatMonthly(idx>=2); // >£90k → default ticked
      },[tierKey]);

      // Individual intent toggles
      React.useEffect(()=>{
        if(who!=="individual") return;
        if(isSoleBusiness){
          setSaSoleBusiness(true);
          setSaNonBusiness(false);
        }else{
          setSaSoleBusiness(false);
          setSaNonBusiness(true);
        }
      },[who,isSoleBusiness]);

      return {
        step,setStep,
        who,setWho,companyType,setCompanyType,tierKey,setTierKey,
        isTrades,setIsTrades,dormant,setDormant,yearEnd,setYearEnd,
        employees,setEmployees,spvProperties,setSpvProperties,personalProperties,setPersonalProperties,
        includePayroll,setIncludePayroll,includeBookkeeping,setIncludeBookkeeping,includeSingleSA,setIncludeSingleSA,vatMonthly,setVatMonthly,
        isSoleBusiness,setIsSoleBusiness,saNonBusiness,setSaNonBusiness,saSoleBusiness,setSaSoleBusiness,
        bkBand,setBkBand,
        additionalDirectorSAs,setAdditionalDirectorSAs,
        isCISContractor,setIsCISContractor,isCISSubcontractor,setIsCISSubcontractor,
        cisMonthlyReturns,setCisMonthlyReturns,cisSubbies,setCisSubbies,trackCISStatements,setTrackCISStatements,cisVerification,setCisVerification,
        ihtReview,setIhtReview,trustsWork,setTrustsWork,cgtWork,setCgtWork,propIncorpReview,setPropIncorpReview,
        p11d,setP11d,p11dEmployees,setP11dEmployees,
        dirPayOptimiser,setDirPayOptimiser
      };
    }

    // Helpers
    function monthsSince(dateStr){
      if(!dateStr) return 0;
      const d = new Date(dateStr);
      const now = new Date();
      let months = (now.getFullYear()-d.getFullYear())*12 + (now.getMonth()-d.getMonth());
      if (now.getDate() < d.getDate()) months -= 1;
      return Math.max(0, months);
    }

    function calcPricing(s){
      const tier = REVENUE_TIERS.find(t=>t.key===s.tierKey) || REVENUE_TIERS[0];
      const m = tier.multiplier;

      const monthly=[], oneoff=[];
      let monthlyBase = 0; // for catch-up calc

      // MONTHLY (skip for dormant Ltd; skip for landlord; skip for individual personal SA only)
      const allowMonthly =
        !(s.who==="limited" && s.dormant) &&
        s.who!=="landlord" &&
        !(s.who==="individual" && !s.isSoleBusiness);

      if(allowMonthly){
        if(s.who==="limited"){
          const base = 90*m;
          monthly.push({label:"Standard Company Package (base)",note:"YE accounts & CT600 · 1 director SA included · Payroll 1–2 · CS filing (SBX absorbs £34) · QuickBooks · Bookkeeping",amount:base});
          monthlyBase += base;

          // DEDUCTIONS (negative lines)
          if(!s.includeBookkeeping) monthly.push({label:"Bookkeeping removed", amount: -20});
          if(!s.includePayroll)     monthly.push({label:"Payroll (1–2) removed", amount: -10});
          if(!s.includeSingleSA)    monthly.push({label:"Single director SA removed", amount: -10}); // £10/mo reduction

          // Add-ons
          if(s.includePayroll){
            const extra = Math.max(0, s.employees - 2) * 6;
            if(extra>0) monthly.push({label:"Payroll add-on (over 2 employees)",amount:extra});
          }

          if(s.companyType==="property" && s.spvProperties>0){
            const pbase=(55 + Math.max(0,s.spvProperties-1)*5)*m;
            monthly.push({label:"Property Company Package",note:`for ${s.spvProperties} subcontractor${s.spvProperties>1?'s':''}?`,amount:pbase}); // note is irrelevant, kept simple
            monthlyBase += pbase;
          }

          if(s.vatMonthly) monthly.push({label:"VAT Returns (averaged monthly)",amount:20});

        } else if(s.who==="partnership"){
          const base = 40*m; // compliance & YE accounts (standard)
          monthly.push({label:"Partnership Compliance & Year-end (base)",amount:base});
          monthlyBase += base;

          // bookkeeping support
          const bkAdds = { none:0, low:25*m, med:45*m, high:75*m };
          if(s.bkBand!=="none"){
            monthly.push({label:`Bookkeeping support (${s.bkBand})`,amount:bkAdds[s.bkBand]});
            monthlyBase += bkAdds[s.bkBand];
          }
          if(s.vatMonthly) monthly.push({label:"VAT Returns (averaged monthly)",amount:20});
          if(s.employees>0) monthly.push({label:"Payroll add-on",amount:10*s.employees}); // simple band

        } else if(s.who==="individual" && s.isSoleBusiness){
          const base = 35*m; // compliance & YE accounts standard
          monthly.push({label:"Sole Trader Compliance & Year-end (base)",amount:base});
          monthlyBase += base;

          const bkAdds = { none:0, low:20*m, med:40*m, high:65*m };
          if(s.bkBand!=="none"){
            monthly.push({label:`Bookkeeping support (${s.bkBand})`,amount:bkAdds[s.bkBand]});
            monthlyBase += bkAdds[s.bkBand];
          }
          if(s.vatMonthly) monthly.push({label:"VAT Returns (averaged monthly)",amount:20});
          if(s.employees>0) monthly.push({label:"Payroll add-on",amount:10*s.employees});
        }

        // CIS monthly (Contractor)
        if(s.isTrades && s.isCISContractor && s.cisMonthlyReturns){
          const extra = Math.max(0, s.cisSubbies - 5) * 2;
          const amount = 20 + extra;
          monthly.push({
            label:"CIS Monthly Returns (contractor)",
            note:`for ${s.cisSubbies} subcontractor${s.cisSubbies===1?'':'s'}`,
            amount
          });
        }
      }

      // ONE-OFFS

      // Dormant pack
      if(s.who==="limited" && s.dormant){
        oneoff.push({label:"Dormant Accounts & Confirmation Statement",amount:120});
      }

      // Bookkeeping catch-up beyond 4 months — based on *calculated monthly total* (after deductions)
      if(s.who==="limited" && !s.dormant && s.yearEnd){
        // compute current monthly total (including deductions)
        const tmpMonthlyTotal = monthly.reduce((a,b)=>a+(b.amount||0),0);
        const months = monthsSince(s.yearEnd);
        const billable = Math.max(0, months - 4);
        if(billable>0 && tmpMonthlyTotal>0){
          oneoff.push({label:`Bookkeeping catch-up — ${billable} month${billable>1?'s':''} (based on your monthly package)`,amount:billable * tmpMonthlyTotal});
        }
      }

      // Self Assessments
      if(s.who==="individual" && s.isSoleBusiness && s.saSoleBusiness){
        let sa=200; if(s.tierKey==="30_90") sa=230; if(s.tierKey==="90_150") sa=270; if(s.tierKey==="150_250") sa=320; if(s.tierKey==="250_350") sa=350; if(s.tierKey==="350p") sa=380;
        oneoff.push({label:"Self-Assessment (sole trader business)",note:REVENUE_TIERS.find(t=>t.key===s.tierKey).label,amount:sa});
      }
      if(s.who==="individual" && !s.isSoleBusiness && s.saNonBusiness){
        oneoff.push({label:"Self-Assessment (personal — investments/other)",amount:150});
      }
      if(s.who==="landlord"){
        const base = 150 + Math.max(0, s.personalProperties) * 20;
        oneoff.push({label:"Self-Assessment (personal landlord)",note:`${s.personalProperties} rental propert${s.personalProperties===1?'y':'ies'}`,amount:base});
      }
      if(s.who==="limited" && s.additionalDirectorSAs>0){
        const pricePer = 180;
        oneoff.push({label:`Additional directors (Self Assessment) ×${s.additionalDirectorSAs}`,amount: pricePer * s.additionalDirectorSAs});
      }

      // CIS free/notes
      if(s.isTrades && s.isCISContractor && s.cisVerification){
        oneoff.push({label:"CIS contractor verification/setup",note:"Free",amount:0});
      }
      if(s.isTrades && s.isCISSubcontractor && s.trackCISStatements){
        oneoff.push({label:"CIS statements tracking (subcontractor)",note:"Free",amount:0});
      }

      // Specialist items (focused)
      if(s.ihtReview)        oneoff.push({label:"IHT Review & Recommendations",amount:250});
      if(s.trustsWork)       oneoff.push({label:"Trusts / Family Investment Structures – scoping consult",amount:150});
      if(s.cgtWork)          oneoff.push({label:"CGT planning / disposal review",amount:150});
      if(s.propIncorpReview) oneoff.push({label:"Property incorporation (SDLT/CGT) review",amount:295});
      if(s.p11d)             oneoff.push({label:`P11D preparation ×${s.p11dEmployees}`,amount:30*s.p11dEmployees});
      if(s.dirPayOptimiser && s.who!=="individual" && s.who!=="landlord") {
        oneoff.push({label:"Director’s Pay Optimiser (tailored summary)",note:"Free",amount:0});
      }

      // Clean & totals
      const monthlyTotal = monthly.reduce((a,b)=>a+(b.amount||0),0);
      const oneOffTotal  = oneoff.reduce((a,b)=>a+(b.amount||0),0);

      return {monthly, oneoff, monthlyTotal, oneOffTotal};
    }

    // Snake grid (desktop 2-cols snake; mobile single column, no arrows)
    function SnakeGrid({sections}) {
      const isDesktop = useIsDesktop();
      if(!isDesktop){
        return (
          <div className="grid grid-cols-1 gap-6">
            {sections.map((s,i)=>(
              <div key={s.key}>
                <Section stepLabel={s.step} arrow={null} title={s.title} subtitle={s.subtitle}>
                  {s.content}
                </Section>
              </div>
            ))}
          </div>
        );
      }

      // Build snake order (pairs, reverse every odd row)
      const pairwise=[];
      for(let i=0;i<sections.length;i+=2){
        const pair = sections.slice(i,i+2);
        if((i/2)%1===0.5){} // no-op (just to avoid lint)
        pairwise.push(pair);
      }
      const ordered=[];
      pairwise.forEach((pair,idx)=>{
        if(idx%2===1 && pair.length===2) ordered.push(pair[1], pair[0]); else ordered.push(...pair);
      });

      // Compute arrow for each item in ordered list to the next item (following the snake path):
      const arrowFor = (i) => {
        if(i===ordered.length-1) return null;
        // grid coords in 2 cols
        const r = Math.floor(i/2), c = i%2;
        const rn = Math.floor((i+1)/2), cn = (i+1)%2;
        if(rn>r && cn===c) return "down";
        if(rn===r && cn>c) return "right";
        if(rn===r && cn<c) return "left";
        if(rn>r && cn!==c) return "down";
        return "down";
      };

      return (
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          {ordered.map((s,i)=>(
            <div key={s.key}>
              <Section stepLabel={s.step} arrow={arrowFor(i)} title={s.title} subtitle={s.subtitle}>
                {s.content}
              </Section>
            </div>
          ))}
        </div>
      );
    }

    function InputsSnake({ s, onNext }) {
      // Natural order: 1 → 2 → (2a if trades) → 3 (if visible) → 4 → 5 → 6
      const sections = [];

      // Step 1 — Who
      sections.push({
        key:"st1", step:"1", title:"Who is this for?", subtitle:"",
        content:(
          <div className="grid gap-3">
            <label className={`flex items-center gap-3 p-3 border rounded-xl cursor-pointer ${s.who==="limited"?"border-[var(--sbx-blue)] bg-blue-50/40":"border-slate-200"}`}>
              <input type="radio" name="who" checked={s.who==="limited"} onChange={()=>s.setWho("limited")} />
              <div className="font-medium">Limited company</div>
            </label>
            <label className={`flex items-center gap-3 p-3 border rounded-xl cursor-pointer ${s.who==="partnership"?"border-[var(--sbx-blue)] bg-blue-50/40":"border-slate-200"}`}>
              <input type="radio" name="who" checked={s.who==="partnership"} onChange={()=>s.setWho("partnership")} />
              <div className="font-medium">Partnership</div>
            </label>
            <label className={`flex items-center gap-3 p-3 border rounded-xl cursor-pointer ${s.who==="individual"?"border-[var(--sbx-blue)] bg-blue-50/40":"border-slate-200"}`}>
              <input type="radio" name="who" checked={s.who==="individual"} onChange={()=>s.setWho("individual")} />
              <div className="font-medium">Individual (Sole trader)</div>
            </label>
            <label className={`flex items-center gap-3 p-3 border rounded-xl cursor-pointer ${s.who==="landlord"?"border-[var(--sbx-blue)] bg-blue-50/40":"border-slate-200"}`}>
              <input type="radio" name="who" checked={s.who==="landlord"} onChange={()=>s.setWho("landlord")} />
              <div className="font-medium">Personal Landlord</div>
            </label>
          </div>
        )
      });

      // Step 2 — Profile
      sections.push({
        key:"st2", step:"2", title:"Business profile", subtitle:"Company type, year end, properties & intent",
        content:(
          <>
            {s.who==="limited" && (
              <div className="grid gap-3 mb-4">
                <label className={`flex items-center gap-3 p-3 border rounded-xl cursor-pointer ${s.companyType==="standard"?"border-[var(--sbx-blue)] bg-blue-50/40":"border-slate-200"}`}>
                  <input type="radio" name="coType" checked={s.companyType==="standard"} onChange={()=>s.setCompanyType("standard")}/>
                  <div>
                    <div className="font-medium">Standard Limited Company</div>
                    <p className="text-sm text-[var(--sbx-mute)] mt-1">
                      Our standard company package is <strong>£90pm</strong> and includes <em>year-end accounts & CT return, single director Self Assessment, payroll for 1–2 staff, confirmation statement filing (we absorb the £34 fee), QuickBooks, and full bookkeeping</em>. <strong>Price can reduce</strong> depending on services you don’t need.
                    </p>
                  </div>
                </label>
                <label className={`flex items-center gap-3 p-3 border rounded-xl cursor-pointer ${s.companyType==="property"?"border-[var(--sbx-blue)] bg-blue-50/40":"border-slate-200"}`}>
                  <input type="radio" name="coType" checked={s.companyType==="property"} onChange={()=>s.setCompanyType("property")}/>
                  <div className="font-medium">Property Investment Company (SPV)</div>
                </label>
              </div>
            )}

            <div className="grid md:grid-cols-2 gap-4">
              {s.who==="limited" && (
                <>
                  <div className="flex items-center gap-2">
                    <input id="dormant" type="checkbox" checked={s.dormant} onChange={e=>s.setDormant(e.target.checked)} />
                    <label htmlFor="dormant" className="text-sm">Company is dormant / not trading</label>
                  </div>

                  <div>
                    <label className="block text-sm mb-1">Company year end date</label>
                    <input type="date" value={s.yearEnd} onChange={e=>s.setYearEnd(e.target.value)} className="w-full border rounded-xl px-3 py-2"/>
                    <p className="text-xs text-[var(--sbx-mute)] mt-1">We’ll calculate catch-up beyond 4 months free.</p>
                  </div>
                </>
              )}

              {(s.who==="limited" || s.who==="partnership" || (s.who==="individual" && s.isSoleBusiness)) && (
                <div className="flex items-center gap-2">
                  <input id="trades" type="checkbox" checked={s.isTrades} onChange={e=>s.setIsTrades(e.target.checked)} />
                  <label htmlFor="trades" className="text-sm">Trades / construction business</label>
                </div>
              )}

              {s.who==="limited" && s.companyType==="property" && (
                <div>
                  <label className="block text-sm mb-1">Number of properties in company (SPV)</label>
                  <input type="number" min="0" value={s.spvProperties} onChange={e=>s.setSpvProperties(Number(e.target.value)||0)} className="w-full border rounded-xl px-3 py-2"/>
                </div>
              )}

              {s.who==="landlord" && (
                <div>
                  <label className="block text-sm mb-1">Personal rental properties</label>
                  <input type="number" min="0" value={s.personalProperties} onChange={e=>s.setPersonalProperties(Number(e.target.value)||0)} className="w-full border rounded-xl px-3 py-2"/>
                </div>
              )}

              {s.who==="individual" && (
                <div className="p-3 border rounded-xl">
                  <p className="font-medium mb-2">For an individual, what do you need?</p>
                  <label className="flex items-center gap-2 text-sm mb-2"><input type="radio" name="indType" checked={s.isSoleBusiness} onChange={()=>s.setIsSoleBusiness(true)}/> I run a business (sole trader)</label>
                  <label className="flex items-center gap-2 text-sm"><input type="radio" name="indType" checked={!s.isSoleBusiness} onChange={()=>s.setIsSoleBusiness(false)}/> I just need a personal Self-Assessment (investments/other)</label>
                </div>
              )}
            </div>

            {s.who==="limited" && (
              <div className="text-xs text-[var(--sbx-mute)] mt-3">
                New Ltd Co signup: <strong>4 months of backdated bookkeeping free.</strong>
              </div>
            )}
          </>
        )
      });

      // Step 2a — CIS (if trades)
      if(s.isTrades){
        sections.push({
          key:"st2cis", step:"2a", title:"CIS options", subtitle:"Contractors and Subcontractors",
          content:(
            <div className="grid md:grid-cols-2 gap-4">
              <div className="p-3 border rounded-xl">
                <p className="font-medium mb-2">Contractor</p>
                <label className="flex items-center gap-3 text-sm mb-2">
                  <input type="checkbox" checked={s.isCISContractor} onChange={e=>s.setIsCISContractor(e.target.checked)}/> I’m a CIS contractor
                </label>
                {s.isCISContractor && (
                  <>
                    <label className="flex items-center gap-3 text-sm mb-2">
                      <input type="checkbox" checked={s.cisMonthlyReturns} onChange={e=>s.setCisMonthlyReturns(e.target.checked)}/> CIS monthly returns
                    </label>
                    <div className="flex items-center gap-2 text-sm mb-2">
                      <span>Subcontractors:</span>
                      <input type="number" min="0" value={s.cisSubbies} onChange={e=>s.setCisSubbies(Number(e.target.value)||0)} className="w-28 border rounded-xl px-3 py-2"/>
                    </div>
                    <div className="text-xs text-[var(--sbx-mute)]">Verification/setup: <strong>free</strong></div>
                  </>
                )}
              </div>
              <div className="p-3 border rounded-xl">
                <p className="font-medium mb-2">Subcontractor</p>
                <label className="flex items-center gap-3 text-sm">
                  <input type="checkbox" checked={s.isCISSubcontractor} onChange={e=>s.setIsCISSubcontractor(e.target.checked)}/> I’m a CIS subcontractor
                </label>
                {s.isCISSubcontractor && (
                  <label className="flex items-center gap-3 text-sm mt-2">
                    <input type="checkbox" checked={s.trackCISStatements} onChange={e=>s.setTrackCISStatements(e.target.checked)}/> Track my CIS deduction statements (free)
                  </label>
                )}
              </div>
            </div>
          )
        });
      }

      // Step 3 — Revenue (hidden for Personal Landlord, and hidden for Individual if personal SA only)
      if(s.who!=="landlord" && !(s.who==="individual" && !s.isSoleBusiness)){
        sections.push({
          key:"st3", step:"3", title:"Revenue band & VAT", subtitle:"",
          content:(
            <div className="space-y-3">
              <div className="grid md:grid-cols-3 gap-3">
                {REVENUE_TIERS.map(t=>(
                  <label key={t.key} className={`flex items-center gap-3 p-3 border rounded-xl cursor-pointer ${s.tierKey===t.key?"border-[var(--sbx-blue)] bg-blue-50/40":"border-slate-200"}`}>
                    <input type="radio" name="tier" checked={s.tierKey===t.key} onChange={()=>s.setTierKey(t.key)}/>
                    <div className="font-medium">{t.label}</div>
                  </label>
                ))}
              </div>
              <label className="flex items-center gap-3 text-sm">
                <input type="checkbox" checked={s.vatMonthly} onChange={e=>s.setVatMonthly(e.target.checked)} />
                VAT registered & need VAT returns (adds monthly VAT service)
              </label>
            </div>
          )
        });
      }

      // Step 4 — Inclusions / adjustments
      sections.push({
        key:"st4", step:"4", title:"What’s included / adjustments", subtitle:"Tailor your package",
        content:(
          <div className="grid md:grid-cols-2 gap-6">
            <div className="space-y-3">
              {s.who==="limited" && (
                <>
                  <label className="flex items-start gap-3 text-sm">
                    <input type="checkbox" checked={s.includeBookkeeping} onChange={e=>s.setIncludeBookkeeping(e.target.checked)} />
                    <span><span className="font-medium">Full bookkeeping (included)</span><br/><span className="text-[var(--sbx-mute)]">Untick to remove.</span></span>
                  </label>
                  <label className="flex items-start gap-3 text-sm">
                    <input type="checkbox" checked={s.includePayroll} onChange={e=>s.setIncludePayroll(e.target.checked)} />
                    <span><span className="font-medium">Payroll for 1–2 staff included</span><br/><span className="text-[var(--sbx-mute)]">Employees beyond 2 add a small fee.</span></span>
                  </label>
                  <label className="flex items-start gap-3 text-sm">
                    <input type="checkbox" checked={s.includeSingleSA} onChange={e=>s.setIncludeSingleSA(e.target.checked)} />
                    <span><span className="font-medium">Single director Self Assessment (included)</span><br/><span className="text-[var(--sbx-mute)]">Untick to reduce price (−£10/mo).</span></span>
                  </label>
                </>
              )}

              {(s.who==="partnership" || (s.who==="individual" && s.isSoleBusiness)) && (
                <div>
                  <label className="block text-sm mb-1">Bookkeeping support</label>
                  <select value={s.bkBand} onChange={e=>s.setBkBand(e.target.value)} className="w-full border rounded-xl px-3 py-2">
                    <option value="none">I do my own bookkeeping (no monthly)</option>
                    <option value="low">Up to ~50 txns/mo</option>
                    <option value="med">50–150 txns/mo</option>
                    <option value="high">150+ txns/mo</option>
                  </select>
                  <p className="text-xs text-[var(--sbx-mute)] mt-1">Year-end accounts are included as standard.</p>
                </div>
              )}
            </div>

            <div className="space-y-3">
              {s.who!=="landlord" && !(s.who==="individual" && !s.isSoleBusiness) && (
                <div>
                  <label className="block text-sm mb-1">Employees on payroll (incl directors)</label>
                  <input type="number" min="0" value={s.employees} onChange={e=>s.setEmployees(Number(e.target.value)||0)} className="w-full border rounded-xl px-3 py-2"/>
                </div>
              )}

              {s.who==="limited" && (
                <div>
                  <label className="block text-sm mb-1">Additional directors requiring Self Assessment</label>
                  <input type="number" min="0" value={s.additionalDirectorSAs} onChange={e=>s.setAdditionalDirectorSAs(Number(e.target.value)||0)} className="w-full border rounded-xl px-3 py-2"/>
                </div>
              )}

              {s.who==="individual" && !s.isSoleBusiness && (
                <label className="flex items-center gap-3 text-sm"><input type="checkbox" checked={s.saNonBusiness} onChange={e=>s.setSaNonBusiness(e.target.checked)}/> Personal Self-Assessment (default)</label>
              )}
            </div>
          </div>
        )
      });

      // Step 5 — Specialist (focused). Also holds Director’s Pay Optimiser (free) except for individual/landlord.
      sections.push({
        key:"st5", step:"5", title:"Specialist/technical work (one-off)", subtitle:"Select any that apply",
        content:(
          <div className="grid md:grid-cols-2 gap-3">
            <label className="flex items-center gap-3 text-sm"><input type="checkbox" checked={s.ihtReview} onChange={e=>s.setIhtReview(e.target.checked)}/> IHT review (£250)</label>
            <label className="flex items-center gap-3 text-sm"><input type="checkbox" checked={s.trustsWork} onChange={e=>s.setTrustsWork(e.target.checked)}/> Trusts / family investment structures consult (£150)</label>
            <label className="flex items-center gap-3 text-sm"><input type="checkbox" checked={s.cgtWork} onChange={e=>s.setCgtWork(e.target.checked)}/> CGT planning / disposal review (£150)</label>
            <label className="flex items-center gap-3 text-sm"><input type="checkbox" checked={s.propIncorpReview} onChange={e=>s.setPropIncorpReview(e.target.checked)}/> Property incorporation (SDLT/CGT) review (£295)</label>
            <div className="flex items-center gap-2 text-sm">
              <input type="checkbox" checked={s.p11d} onChange={e=>s.setP11d(e.target.checked)}/>
              <span>P11D per employee (£30)</span>
              {s.p11d && (<><span className="ml-2">Qty:</span><input type="number" min="1" value={s.p11dEmployees} onChange={e=>s.setP11dEmployees(Number(e.target.value)||1)} className="w-20 border rounded-xl px-3 py-2"/></>)}
            </div>
            {(s.who!=="individual" && s.who!=="landlord") && (
              <label className="flex items-center gap-3 text-sm"><input type="checkbox" checked={s.dirPayOptimiser} onChange={e=>s.setDirPayOptimiser(e.target.checked)}/> Director’s Pay Optimiser (free)</label>
            )}
          </div>
        )
      });

      // Step 6 — Advisory text + email
      sections.push({
        key:"st6", step:"6", title:"Financial advisory", subtitle:"Want to talk it through?",
        content:(
          <div>
            <p className="text-sm text-[var(--sbx-mute)] mb-3">
              We’re happy to discuss your situation (company structure, tax planning, property strategy, trusts, investments, CGT timing) and tailor a plan.
            </p>
            <a className="inline-block px-4 py-2 rounded-xl bg-[var(--sbx-blue)] text-white text-sm font-semibold"
               href="mailto:ryan@sbxaccountants.com?subject=SBX%20Consultation%20Request&body=Hi%20SBX%2C%0A%0AI%27d%20like%20to%20book%20a%20consultation%20to%20discuss%20my%20quote%20and%20requirements.%0A%0AThanks%2C%0A">
               Email Ryan to book a consultation
            </a>
          </div>
        )
      });

      return (
        <>
          <SnakeGrid sections={sections} />
          <div className="no-print flex justify-end mt-6">
            <button className="px-5 py-2 rounded-xl bg-[var(--sbx-blue)] text-white font-semibold" onClick={onNext}>Get Quote</button>
          </div>
        </>
      );
    }

    function Quote({s,onBack}){
      const q = calcPricing(s);
      const printQuote = ()=>window.print();

      return (
        <div className="print-area">
          <div className="card p-6 mb-6">
            <div className="mb-2">
              <h2 className="text-xl font-semibold text-[var(--sbx-blue)]">Your Quote</h2>
              <p className="text-sm text-[var(--sbx-mute)]">Only relevant items are shown. No VAT is added.</p>
            </div>

            <div className="grid lg:grid-cols-2 gap-6">
              <div>
                <h3 className="text-lg font-semibold mb-2">Monthly</h3>
                {q.monthly.length===0?(
                  <p className="text-sm text-[var(--sbx-mute)]">No monthly items selected.</p>
                ):(
                  <ul className="space-y-2">
                    {q.monthly.map((l,i)=>{
                      const isNeg = (l.amount||0) < 0;
                      return (
                        <li key={i} className="flex items-start justify-between gap-4 border-b pb-2">
                          <div>
                            <p className="font-medium">{l.label}</p>
                            {l.note && <p className="text-xs text-[var(--sbx-mute)] mt-0.5">{l.note}</p>}
                          </div>
                          <div className={`font-semibold ${isNeg?'text-red-600':''}`}>
                            {isNeg ? "−"+currency(Math.abs(l.amount)) : currency(l.amount)}/mo
                          </div>
                        </li>
                      );
                    })}
                    <li className="flex items-start justify-between gap-4 pt-2">
                      <div className="font-semibold">Monthly Total</div>
                      <div className="font-semibold">{currency(q.monthlyTotal)}/mo</div>
                    </li>
                  </ul>
                )}
              </div>

              <div>
                <h3 className="text-lg font-semibold mb-2">One-off</h3>
                {q.oneoff.length===0?(
                  <p className="text-sm text-[var(--sbx-mute)]">No one-off items selected.</p>
                ):(
                  <ul className="space-y-2">
                    {q.oneoff.map((l,i)=>(
                      <li key={i} className="flex items-start justify-between gap-4 border-b pb-2">
                        <div>
                          <p className="font-medium">{l.label}</p>
                          {l.note && <p className="text-xs text-[var(--sbx-mute)] mt-0.5">{l.note}</p>}
                        </div>
                        <div className="font-semibold">{currency(l.amount)}</div>
                      </li>
                    ))}
                    <li className="flex items-start justify-between gap-4 pt-2">
                      <div className="font-semibold">One-off Total</div>
                      <div className="font-semibold">{currency(q.oneOffTotal)}</div>
                    </li>
                  </ul>
                )}
              </div>
            </div>

            <div className="mt-4 text-xs text-[var(--sbx-mute)]">
              <ul className="list-disc ml-5 space-y-1">
                <li>New Ltd company signups receive up to <strong>4 months</strong> of backdated bookkeeping free.</li>
              </ul>
            </div>
          </div>

          <div className="no-print flex items-center justify-between gap-3">
            <div className="text-sm text-[var(--sbx-mute)]">Brand: <span className="text-[var(--sbx-blue)] font-semibold">SBX Accountants</span></div>
            <div className="flex gap-3">
              <button className="px-5 py-2 rounded-xl border font-semibold" onClick={onBack}>Back</button>
              <button className="px-5 py-2 rounded-xl bg-[var(--sbx-blue)] text-white font-semibold" onClick={printQuote}>Print</button>
            </div>
          </div>
        </div>
      );
    }

    function App(){
      const s = useQuoteState();
      return (
        <div className="max-w-6xl mx-auto px-4 py-6">
          <header className="no-print mb-6">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-xl bg-[var(--sbx-blue)] text-white font-bold flex items-center justify-center">SBX</div>
                <div>
                  <h1 className="text-2xl md:text-3xl font-semibold text-[var(--sbx-blue)]">SBX Quote Builder</h1>
                  <p className="text-sm text-[var(--sbx-mute)]">Two quick steps. Clear, no-VAT pricing.</p>
                </div>
              </div>
              <span className="text-xs px-2 py-1 rounded-full bg-blue-50 text-[var(--sbx-blue)]">Step {s.step} of 2</span>
            </div>
          </header>

          {s.step===1 ? <InputsSnake s={s} onNext={()=>s.setStep(2)} /> : <Quote s={s} onBack={()=>s.setStep(1)} />}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App/>);
  </script>
</body>
</html>
