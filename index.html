<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SBX Quote Builder</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React + ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    :root {
      --sbx-blue: #004aac;
      --sbx-text: #0f172a;
      --sbx-mute: #64748b;
      --sbx-bg: #f8fafc;
    }
    html, body { height: 100%; }
    body {
      font-family: 'Montserrat', sans-serif;
      background: var(--sbx-bg);
      color: var(--sbx-text);
    }
    @media print {
      .no-print { display: none !important; }
      .print-area { padding: 0 !important; box-shadow: none !important; }
    }
  </style>
</head>
<body class="min-h-screen">
  <div id="root"></div>

  <script type="text/babel">
    const currency = (n) => "£" + (Math.round(n * 100) / 100).toFixed(2);

    const Section = ({title, subtitle, children}) => (
      <div className="bg-white rounded-2xl shadow p-6 mb-6">
        <div className="mb-3">
          <h2 className="text-xl font-semibold text-[var(--sbx-blue)]">{title}</h2>
          {subtitle && <p className="text-sm text-[var(--sbx-mute)] mt-1">{subtitle}</p>}
        </div>
        {children}
      </div>
    );

    const Chip = ({children}) => (
      <span className="inline-block text-xs px-2 py-1 rounded-full bg-blue-50 text-[var(--sbx-blue)]">
        {children}
      </span>
    );

    // Revenue tiers + multipliers applied to monthly packages (all types)
    const REVENUE_TIERS = [
      { key: "u30",  label: "Under £30k",                min: 0,     max: 30000,  multiplier: 1.00 },
      { key: "30_90",label: "£30k – £90k",              min: 30000,  max: 90000,  multiplier: 1.10 },
      { key: "90_150",label: "£90k – £150k",            min: 90000,  max: 150000, multiplier: 1.20 },
      { key: "150_250",label: "£150k – £250k",          min: 150000, max: 250000, multiplier: 1.35 },
      { key: "250p", label: "£250k+",                   min: 250000, max: Infinity, multiplier: 1.50 },
    ];

    function useQuoteState() {
      const [step, setStep] = React.useState(1);

      // Core profile
      const [clientType, setClientType] = React.useState("limited"); // sole|partnership|limited|property
      const [tierKey, setTierKey] = React.useState("30_90"); // default mid
      const [numDirectors, setNumDirectors] = React.useState(1);
      const [numEmployees, setNumEmployees] = React.useState(1);
      const [numProperties, setNumProperties] = React.useState(1);
      const [isTrades, setIsTrades] = React.useState(false);
      const [isDormant, setIsDormant] = React.useState(false);

      // Services (page 1)
      const [wantsMonthly, setWantsMonthly] = React.useState(true);
      const [needsCompanySetup, setNeedsCompanySetup] = React.useState(false);
      const [wantsQB, setWantsQB] = React.useState(true); // auto-included for Ltd package, optional for others
      const [wantsPayroll, setWantsPayroll] = React.useState(true);
      const [wantsVAT, setWantsVAT] = React.useState(false); // hidden when tier >= £90k

      // Self-assessment
      const [saNonBusiness, setSaNonBusiness] = React.useState(false); // flat £150
      const [saSoleBusiness, setSaSoleBusiness] = React.useState(false); // tiered
      const [extraDirectorSAs, setExtraDirectorSAs] = React.useState(0); // £10 reduction each

      // Trades / CIS
      const [tradesBundle, setTradesBundle] = React.useState(false);
      const [cisMonthlyReturns, setCisMonthlyReturns] = React.useState(false);
      const [cisSubbies, setCisSubbies] = React.useState(0);
      const [cisSetup, setCisSetup] = React.useState(false);

      // Specialist one-offs
      const [ihtReview, setIhtReview] = React.useState(false);
      const [sa1Reg, setSa1Reg] = React.useState(false);
      const [cwf1Reg, setCwf1Reg] = React.useState(false);
      const [payeReg, setPayeReg] = React.useState(false);
      const [vatReg, setVatReg] = React.useState(false);
      const [p11d, setP11d] = React.useState(false);
      const [p11dEmployees, setP11dEmployees] = React.useState(1);

      return {
        step, setStep,
        clientType, setClientType,
        tierKey, setTierKey,
        numDirectors, setNumDirectors,
        numEmployees, setNumEmployees,
        numProperties, setNumProperties,
        isTrades, setIsTrades,
        isDormant, setIsDormant,
        wantsMonthly, setWantsMonthly,
        needsCompanySetup, setNeedsCompanySetup,
        wantsQB, setWantsQB,
        wantsPayroll, setWantsPayroll,
        wantsVAT, setWantsVAT,
        saNonBusiness, setSaNonBusiness,
        saSoleBusiness, setSaSoleBusiness,
        extraDirectorSAs, setExtraDirectorSAs,
        tradesBundle, setTradesBundle,
        cisMonthlyReturns, setCisMonthlyReturns,
        cisSubbies, setCisSubbies,
        cisSetup, setCisSetup,
        ihtReview, setIhtReview,
        sa1Reg, setSa1Reg,
        cwf1Reg, setCwf1Reg,
        payeReg, setPayeReg,
        vatReg, setVatReg,
        p11d, setP11d,
        p11dEmployees, setP11dEmployees,
      };
    }

    function calcPricing(s) {
      const tier = REVENUE_TIERS.find(t => t.key === s.tierKey) || REVENUE_TIERS[0];
      const m = tier.multiplier;

      const linesMonthly = [];
      const linesOneOff  = [];

      // ---- Monthly packages
      if (s.wantsMonthly) {
        if (s.clientType === "limited") {
          // Base £90 with multiplier
          let pkg = 90 * m;

          // Payroll beyond 2 staff: +£6 per extra
          if (s.wantsPayroll) {
            const extra = Math.max(0, s.numEmployees - 2) * 6;
            if (extra > 0) linesMonthly.push({ label: "Payroll add-on (over 2 employees)", amount: extra });
          }

          linesMonthly.push({
            label: "Standard Company Package",
            note: "YE accounts, CT600, 1 director SA (includes £10 reduction), payroll 1–2, CS, QB, bookkeeping",
            amount: pkg
          });

        } else if (s.clientType === "property") {
          // Property package: £55 base + £5 per extra property, then multiplier
          const base = 55 + Math.max(0, s.numProperties - 1) * 5;
          linesMonthly.push({
            label: "Property Company Package",
            note: `${s.numProperties} propert${s.numProperties>1?"ies":"y"}`,
            amount: base * m
          });

        } else if (s.clientType === "partnership") {
          // Partnership monthly bookkeeping/compliance bundle
          linesMonthly.push({
            label: "Partnership Package",
            note: "Bookkeeping & quarterly reviews",
            amount: 80 * m
          });

        } else if (s.clientType === "sole") {
          // Sole trader monthly bookkeeping
          linesMonthly.push({
            label: "Sole Trader Bookkeeping Package",
            note: "Bookkeeping & quarterly reviews",
            amount: 60 * m
          });
        }

        // QB optional if not already included (Ltd includes it implicitly)
        if (s.wantsQB && s.clientType !== "limited") {
          linesMonthly.push({ label: "QuickBooks Subscription", amount: 12 });
        }

        // VAT monthly handling (only show UC when revenue ≤ £90k)
        const vatTierIndex = REVENUE_TIERS.findIndex(t => t.key === s.tierKey);
        const showVATOption = vatTierIndex <= 1; // tiers 0 or 1 (≤ £90k)
        if (showVATOption && s.wantsVAT) {
          linesMonthly.push({ label: "VAT Returns (averaged monthly)", amount: 20 });
        }

        // Trades bundle (only if trades)
        if (s.isTrades && s.tradesBundle) {
          const extra = Math.max(0, s.cisSubbies - 5) * 2;
          linesMonthly.push({
            label: "Trades Bundle",
            note: `CIS returns up to 5 subbies${extra>0?`, +£2 per extra (${s.cisSubbies} total)`:''}`,
            amount: 20 + extra
          });

          if (s.cisMonthlyReturns) {
            linesMonthly.push({ label: "CIS Monthly Filing Service", note: "Included in Trades Bundle", amount: 0 });
          }
        }
      }

      // ---- One-off items
      if (s.needsCompanySetup && (s.clientType === "limited" || s.clientType === "property")) {
        const includedFree = s.wantsMonthly; // free with monthly company packages
        linesOneOff.push({ label: "Company Formation (SBX fee)", note: includedFree ? "Free with monthly package" : "Standalone", amount: includedFree ? 0 : 75 });
        linesOneOff.push({ label: "Companies House Incorporation Fee (recharged at cost)", amount: 50 });
      }

      // Self assessments
      if (s.saNonBusiness) linesOneOff.push({ label: "Self-Assessment (non-business income)", amount: 150 });

      if (s.saSoleBusiness && s.clientType === "sole") {
        // Tiered SA by revenue tier
        let sa = 200; // base
        if (s.tierKey === "30_90") sa = 230;
        if (s.tierKey === "90_150") sa = 270;
        if (s.tierKey === "150_250") sa = 320;
        if (s.tierKey === "250p") sa = 370;
        linesOneOff.push({ label: "Self-Assessment (sole trader business)", note: REVENUE_TIERS.find(t=>t.key===s.tierKey).label, amount: sa });
      }

      if (s.extraDirectorSAs > 0 && (s.clientType === "limited" || s.clientType === "property")) {
        const base = 190; // typical business SA baseline
        const discounted = base - 10; // £10 reduction each
        linesOneOff.push({ label: `Additional Director Self-Assessment ×${s.extraDirectorSAs}`, note: "£10 reduction applied", amount: discounted * s.extraDirectorSAs });
      }

      if (s.isTrades && s.cisSetup) linesOneOff.push({ label: "CIS Setup / Verification", amount: 40 });

      // Specialist one-offs
      if (s.ihtReview) linesOneOff.push({ label: "IHT Initial Review & Recommendations", amount: 250 });
      if (s.sa1Reg) linesOneOff.push({ label: "SA1 Registration", amount: 35 });
      if (s.cwf1Reg) linesOneOff.push({ label: "CWF1 Registration (set up as sole trader)", amount: 35 });
      if (s.payeReg) linesOneOff.push({ label: "PAYE Registration", amount: 50 });
      if (s.vatReg) linesOneOff.push({ label: "VAT Registration", amount: 75 });
      if (s.p11d) linesOneOff.push({ label: `P11D Preparation ×${s.p11dEmployees}`, amount: 30 * s.p11dEmployees });

      // Dormant company one-off
      if (s.isDormant && (s.clientType === "limited" || s.clientType === "property")) {
        linesOneOff.push({ label: "Dormant Accounts & Confirmation Statement", amount: 120 });
      }

      // Totals & clean display
      const cleanMonthly = linesMonthly.filter(l => l.amount > 0);
      const cleanOneOff  = linesOneOff.filter(l => l.amount > 0 || (l.amount === 0 && l.note)); // keep explicit £0 when informative
      const monthlyTotal = cleanMonthly.reduce((a,b)=>a+(b.amount||0),0);
      const oneOffTotal  = cleanOneOff.reduce((a,b)=>a+(b.amount||0),0);

      return { monthly: cleanMonthly, oneoff: cleanOneOff, monthlyTotal, oneOffTotal };
    }

    function InputsStep({ s, goNext }) {
      const tierIndex = REVENUE_TIERS.findIndex(t => t.key === s.tierKey);
      const showVATOption = tierIndex <= 1; // only when ≤ £90k

      return (
        <>
          <Section title="Business Basics" subtitle="Fill this page, then get your quote on the next step.">
            <div className="grid md:grid-cols-2 gap-6">
              <div>
                <label className="block text-sm font-medium mb-1">Business Type</label>
                <select value={s.clientType} onChange={e=>s.setClientType(e.target.value)} className="w-full border rounded-lg px-3 py-2">
                  <option value="sole">Sole Trader</option>
                  <option value="partnership">Partnership</option>
                  <option value="limited">Limited Company</option>
                  <option value="property">Property Investment Company</option>
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium mb-1">Annual Revenue Band</label>
                <select value={s.tierKey} onChange={e=>s.setTierKey(e.target.value)} className="w-full border rounded-lg px-3 py-2">
                  {REVENUE_TIERS.map(t => <option key={t.key} value={t.key}>{t.label}</option>)}
                </select>
                {tierIndex >= 2 && (
                  <p className="text-xs text-[var(--sbx-mute)] mt-1">Over £90k — VAT registration is typically required. We won’t show the VAT monthly option.</p>
                )}
              </div>

              {(s.clientType === "limited" || s.clientType === "property") && (
                <>
                  <div>
                    <label className="block text-sm font-medium mb-1">Directors</label>
                    <input type="number" min="1" value={s.numDirectors} onChange={e=>s.setNumDirectors(Number(e.target.value)||1)} className="w-full border rounded-lg px-3 py-2"/>
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Employees (incl. directors on payroll)</label>
                    <input type="number" min="1" value={s.numEmployees} onChange={e=>s.setNumEmployees(Number(e.target.value)||1)} className="w-full border rounded-lg px-3 py-2"/>
                  </div>
                </>
              )}

              {s.clientType === "property" && (
                <div>
                  <label className="block text-sm font-medium mb-1">Number of Properties</label>
                  <input type="number" min="1" value={s.numProperties} onChange={e=>s.setNumProperties(Number(e.target.value)||1)} className="w-full border rounded-lg px-3 py-2"/>
                </div>
              )}

              <div className="flex items-center gap-3">
                <input id="trades" type="checkbox" checked={s.isTrades} onChange={e=>s.setIsTrades(e.target.checked)} />
                <label htmlFor="trades" className="text-sm">Trades / Construction business</label>
              </div>

              {(s.clientType === "limited" || s.clientType === "property") && (
                <div className="flex items-center gap-3">
                  <input id="dormant" type="checkbox" checked={s.isDormant} onChange={e=>s.setIsDormant(e.target.checked)} />
                  <label htmlFor="dormant" className="text-sm">Company is dormant / not currently trading</label>
                </div>
              )}
            </div>
          </Section>

          <Section title="Services">
            <div className="grid md:grid-cols-2 gap-6">
              <div className="space-y-3">
                <label className="flex items-center gap-3 text-sm">
                  <input type="checkbox" checked={s.wantsMonthly} onChange={e=>s.setWantsMonthly(e.target.checked)} />
                  Monthly package
                </label>

                {(s.clientType === "limited" || s.clientType === "property") && (
                  <label className="flex items-center gap-3 text-sm">
                    <input type="checkbox" checked={s.needsCompanySetup} onChange={e=>s.setNeedsCompanySetup(e.target.checked)} />
                    Company formation needed? <span className="ml-1 text-[var(--sbx-blue)] font-medium">Free with monthly package</span> (we recharge the £50 fee).
                  </label>
                )}

                {s.clientType !== "limited" && (
                  <label className="flex items-center gap-3 text-sm">
                    <input type="checkbox" checked={s.wantsQB} onChange={e=>s.setWantsQB(e.target.checked)} />
                    QuickBooks subscription
                  </label>
                )}

                <label className="flex items-center gap-3 text-sm">
                  <input type="checkbox" checked={s.wantsPayroll} onChange={e=>s.setWantsPayroll(e.target.checked)} />
                  Payroll
                </label>

                {showVATOption && (
                  <label className="flex items-center gap-3 text-sm">
                    <input type="checkbox" checked={s.wantsVAT} onChange={e=>s.setWantsVAT(e.target.checked)} />
                    VAT returns (averaged monthly)
                  </label>
                )}
              </div>

              <div className="space-y-3">
                <p className="text-sm font-medium">Self-Assessment</p>
                <label className="flex items-center gap-3 text-sm">
                  <input type="checkbox" checked={s.saNonBusiness} onChange={e=>s.setSaNonBusiness(e.target.checked)} />
                  Non-business income only (flat £150)
                </label>

                {s.clientType === "sole" && (
                  <label className="flex items-center gap-3 text-sm">
                    <input type="checkbox" checked={s.saSoleBusiness} onChange={e=>s.setSaSoleBusiness(e.target.checked)} />
                    Sole trader business Self-Assessment (tiered by revenue)
                  </label>
                )}

                {(s.clientType === "limited" || s.clientType === "property") && (
                  <div className="flex items-center gap-2 text-sm">
                    <span>Additional director SAs:</span>
                    <input type="number" min="0" value={s.extraDirectorSAs} onChange={e=>s.setExtraDirectorSAs(Number(e.target.value)||0)} className="w-24 border rounded-lg px-3 py-1"/>
                    <span className="text-xs text-[var(--sbx-mute)]">£10 reduction each</span>
                  </div>
                )}

                {s.isTrades && (
                  <>
                    <hr className="my-2"/>
                    <p className="text-sm font-medium">Trades / CIS</p>
                    <label className="flex items-center gap-3 text-sm">
                      <input type="checkbox" checked={s.tradesBundle} onChange={e=>s.setTradesBundle(e.target.checked)} />
                      Enable Trades Bundle (CIS help, DRC guidance, templates)
                    </label>
                    <label className="flex items-center gap-3 text-sm">
                      <input type="checkbox" checked={s.cisMonthlyReturns} onChange={e=>s.setCisMonthlyReturns(e.target.checked)} />
                      CIS monthly returns
                    </label>
                    <div className="flex items-center gap-2 text-sm">
                      <span>Subcontractors:</span>
                      <input type="number" min="0" value={s.cisSubbies} onChange={e=>s.setCisSubbies(Number(e.target.value)||0)} className="w-24 border rounded-lg px-3 py-1"/>
                    </div>
                    <label className="flex items-center gap-3 text-sm">
                      <input type="checkbox" checked={s.cisSetup} onChange={e=>s.setCisSetup(e.target.checked)} />
                      CIS setup / verification (one-off)
                    </label>
                  </>
                )}

                <hr className="my-2"/>
                <p className="text-sm font-medium">Specialist one-offs</p>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                  <label className="flex items-center gap-2 text-sm"><input type="checkbox" checked={s.ihtReview} onChange={e=>s.setIhtReview(e.target.checked)}/> IHT review (£250)</label>
                  <label className="flex items-center gap-2 text-sm"><input type="checkbox" checked={s.sa1Reg} onChange={e=>s.setSa1Reg(e.target.checked)}/> SA1 registration (£35)</label>
                  <label className="flex items-center gap-2 text-sm"><input type="checkbox" checked={s.cwf1Reg} onChange={e=>s.setCwf1Reg(e.target.checked)}/> CWF1 registration (£35)</label>
                  <label className="flex items-center gap-2 text-sm"><input type="checkbox" checked={s.payeReg} onChange={e=>s.setPayeReg(e.target.checked)}/> PAYE registration (£50)</label>
                  <label className="flex items-center gap-2 text-sm"><input type="checkbox" checked={s.vatReg} onChange={e=>s.setVatReg(e.target.checked)}/> VAT registration (£75)</label>
                  <div className="flex items-center gap-2 text-sm">
                    <input type="checkbox" checked={s.p11d} onChange={e=>s.setP11d(e.target.checked)}/>
                    <span>P11D per employee (£30)</span>
                    {s.p11d && (
                      <>
                        <span className="ml-2">Qty:</span>
                        <input type="number" min="1" value={s.p11dEmployees} onChange={e=>s.setP11dEmployees(Number(e.target.value)||1)} className="w-20 border rounded-lg px-3 py-1"/>
                      </>
                    )}
                  </div>
                </div>
              </div>
            </div>
          </Section>

          <div className="no-print flex justify-end">
            <button onClick={goNext} className="px-5 py-2 rounded-xl bg-[var(--sbx-blue)] text-white font-semibold">Get Quote</button>
          </div>
        </>
      );
    }

    function QuoteStep({ s, goBack }) {
      const quote = calcPricing(s);
      const printQuote = () => window.print();

      return (
        <div className="print-area">
          <Section title="Your Quote" subtitle="Only relevant items are shown (no VAT added)">
            <div className="grid md:grid-cols-2 gap-6">
              <div>
                <h3 className="text-lg font-semibold mb-2">Monthly</h3>
                {quote.monthly.length === 0 ? (
                  <p className="text-sm text-[var(--sbx-mute)]">No monthly items selected.</p>
                ) : (
                  <ul className="space-y-2">
                    {quote.monthly.map((l, i) => (
                      <li key={i} className="flex items-start justify-between gap-4 border-b pb-2">
                        <div>
                          <p className="font-medium">{l.label}</p>
                          {l.note && <p className="text-xs text-[var(--sbx-mute)] mt-0.5">{l.note}</p>}
                        </div>
                        <div className="font-semibold">{currency(l.amount)}/mo</div>
                      </li>
                    ))}
                    <li className="flex items-start justify-between gap-4 pt-2">
                      <div className="font-semibold">Monthly Total</div>
                      <div className="font-semibold">{currency(quote.monthlyTotal)}/mo</div>
                    </li>
                  </ul>
                )}
              </div>

              <div>
                <h3 className="text-lg font-semibold mb-2">One-off</h3>
                {quote.oneoff.length === 0 ? (
                  <p className="text-sm text-[var(--sbx-mute)]">No one-off items selected.</p>
                ) : (
                  <ul className="space-y-2">
                    {quote.oneoff.map((l, i) => (
                      <li key={i} className="flex items-start justify-between gap-4 border-b pb-2">
                        <div>
                          <p className="font-medium">{l.label}</p>
                          {l.note && <p className="text-xs text-[var(--sbx-mute)] mt-0.5">{l.note}</p>}
                        </div>
                        <div className="font-semibold">{currency(l.amount)}</div>
                      </li>
                    ))}
                    <li className="flex items-start justify-between gap-4 pt-2">
                      <div className="font-semibold">One-off Total</div>
                      <div className="font-semibold">{currency(quote.oneOffTotal)}</div>
                    </li>
                  </ul>
                )}
              </div>
            </div>

            <div className="mt-4 text-xs text-[var(--sbx-mute)]">
              <ul className="list-disc ml-5 space-y-1">
                <li>No VAT is added to these prices.</li>
                <li>Company formation is free with monthly company packages; the £50 Companies House fee is recharged at cost.</li>
                <li>New company clients get up to 4 months of backdated bookkeeping free when signing up.</li>
              </ul>
            </div>
          </Section>

          <div className="no-print flex items-center justify-between gap-3">
            <div className="text-sm text-[var(--sbx-mute)]">Brand: <span className="text-[var(--sbx-blue)] font-semibold">SBX Accountants</span></div>
            <div className="flex gap-3">
              <button className="px-5 py-2 rounded-xl border font-semibold" onClick={goBack}>Back</button>
              <button className="px-5 py-2 rounded-xl bg-[var(--sbx-blue)] text-white font-semibold" onClick={printQuote}>Print</button>
            </div>
          </div>
        </div>
      );
    }

    function App() {
      const s = useQuoteState();
      const goNext = () => s.setStep(2);
      const goBack = () => s.setStep(1);

      return (
        <div className="max-w-5xl mx-auto px-4 py-6">
          <header className="no-print mb-6">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-xl bg-[var(--sbx-blue)] flex items-center justify-center text-white font-bold">SBX</div>
                <div>
                  <h1 className="text-2xl md:text-3xl font-bold text-[var(--sbx-blue)]">SBX Quote Builder</h1>
                  <p className="text-sm text-[var(--sbx-mute)]">Two quick steps. Clear, no-VAT pricing.</p>
                </div>
              </div>
              <Chip>Step {s.step} of 2</Chip>
            </div>
          </header>

          {s.step === 1 ? <InputsStep s={s} goNext={goNext} /> : <QuoteStep s={s} goBack={goBack} />}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
