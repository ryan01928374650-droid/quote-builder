<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SBX Quote Builder</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React + ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    :root{
      --sbx-blue:#004aac;
      --sbx-text:#0f172a;
      --sbx-mute:#64748b;
      --sbx-bg:#f6f7fb;
      --card-min-h: 320px; /* keep boxes same size */
      --arrow-size: 22px;
    }
    html,body{height:100%}
    body{
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background:var(--sbx-bg);
      color:var(--sbx-text);
    }
    .card{background:#fff;border-radius:16px;box-shadow:0 8px 24px rgba(2,6,23,0.08);min-height:var(--card-min-h)}
    .step-badge{
      display:inline-flex;align-items:center;gap:10px;
      padding:4px 12px;border-radius:999px;background:var(--sbx-blue);color:#fff;
      font-weight:700;font-size:12px;letter-spacing:.02em
    }
    .step-arrow{
      font-size:var(--arrow-size);line-height:1;color:var(--sbx-blue);
    }
    input[type="checkbox"], input[type="radio"]{
      width:22px;height:22px;accent-color:var(--sbx-blue);cursor:pointer;
    }
    select, input[type="number"], input[type="text"], input[type="date"]{ font-size:15px; }
    @media (max-width: 1023px){
      /* arrows always point down on mobile, hide lateral arrows */
      .arrow-right, .arrow-left { display:none }
    }
    @media print{
      .no-print{display:none!important}
      .print-area{box-shadow:none!important;padding:0!important}
      body{background:#fff}
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const currency = n=>"£"+(Math.round(n*100)/100).toFixed(2);

    const REVENUE_TIERS=[
      {key:"u30",label:"Under £30k",min:0,max:30000,multiplier:1.00},
      {key:"30_90",label:"£30k – £90k",min:30000,max:90000,multiplier:1.10},
      {key:"90_150",label:"£90k – £150k",min:90000,max:150000,multiplier:1.20},
      {key:"150_250",label:"£150k – £250k",min:150000,max:250000,multiplier:1.35},
      {key:"250p",label:"£250k+",min:250000,max:Infinity,multiplier:1.50},
    ];

    const bigArrow = (dir) => {
      if(!dir) return null;
      const map = { right:"→", down:"↓", left:"←", up:"↑" };
      return <span className={`step-arrow arrow-${dir}`}>{map[dir]}</span>;
    };

    const Section = ({stepLabel, arrowDir, title, subtitle, children})=>(
      <div className="card p-6 h-full flex flex-col">
        <div className="mb-3 flex items-center justify-between">
          <span className="step-badge">Step&nbsp;{stepLabel} {bigArrow(arrowDir)}</span>
        </div>
        <h2 className="text-xl font-semibold text-[var(--sbx-blue)]">{title}</h2>
        {subtitle && <p className="text-sm text-[var(--sbx-mute)] mt-1">{subtitle}</p>}
        <div className="mt-3 flex-1">{children}</div>
      </div>
    );

    function useIsDesktop() {
      const [isDesktop,setIsDesktop]=React.useState(() => window.matchMedia("(min-width:1024px)").matches);
      React.useEffect(()=>{
        const mq=window.matchMedia("(min-width:1024px)");
        const handler=()=>setIsDesktop(mq.matches);
        mq.addEventListener ? mq.addEventListener("change",handler) : mq.addListener(handler);
        return ()=> mq.removeEventListener ? mq.removeEventListener("change",handler) : mq.removeListener(handler);
      },[]);
      return isDesktop;
    }

    function useQuoteState(){
      const [step,setStep]=React.useState(1);

      // Entity
      const [who,setWho]=React.useState("limited"); // limited|partnership|sole
      const [companyType,setCompanyType]=React.useState("standard"); // standard|property
      const [tierKey,setTierKey]=React.useState("30_90");
      const [isTrades,setIsTrades]=React.useState(false);
      const [dormant,setDormant]=React.useState(false);
      const [yearEnd,setYearEnd]=React.useState(""); // yyyy-mm-dd

      // Counts
      const [employees,setEmployees]=React.useState(1); // includes directors on payroll
      const [spvProperties,setSpvProperties]=React.useState(1); // Ltd SPV properties
      const [personalProperties,setPersonalProperties]=React.useState(0); // personal landlord

      // Inclusions (monthly always on; QB always included)
      const [includePayroll,setIncludePayroll]=React.useState(true);     // 1–2 included by default
      const [includeBookkeeping,setIncludeBookkeeping]=React.useState(true);
      const [includeSingleSA,setIncludeSingleSA]=React.useState(true);   // can remove to reduce by £10pm
      const [vatMonthly,setVatMonthly]=React.useState(false);            // hidden if >£90k

      // Self-assessment options
      const [saSoleBusiness,setSaSoleBusiness]=React.useState(false);    // for sole traders
      const [saNonBusiness,setSaNonBusiness]=React.useState(false);      // non-business SA (e.g., landlord)
      const [additionalDirectorSAs,setAdditionalDirectorSAs]=React.useState(0);

      // Trades / CIS (split contractor vs subcontractor)
      const [isCISContractor,setIsCISContractor]=React.useState(false);
      const [isCISSubcontractor,setIsCISSubcontractor]=React.useState(false);
      const [cisMonthlyReturns,setCisMonthlyReturns]=React.useState(false);
      const [cisSubbies,setCisSubbies]=React.useState(0);
      const [trackCISStatements,setTrackCISStatements]=React.useState(false); // free
      const [cisVerification,setCisVerification]=React.useState(true); // shown but free (no charge)

      // Specialist one-offs (no tax registration charges)
      const [ihtReview,setIhtReview]=React.useState(false);
      const [p11d,setP11d]=React.useState(false);
      const [p11dEmployees,setP11dEmployees]=React.useState(1);
      const [dividendPack,setDividendPack]=React.useState(false);
      const [hmrcLetter,setHmrcLetter]=React.useState(false);
      const [coHouseChanges,setCoHouseChanges]=React.useState(false);

      // Advisory
      const [faPayOptimiser,setFaPayOptimiser]=React.useState(false); // free
      const [faTrusts,setFaTrusts]=React.useState(false);
      const [faInvestment,setFaInvestment]=React.useState(false);

      // Auto defaults when dormant
      React.useEffect(()=>{
        if(dormant){
          setEmployees(0);
          setSpvProperties(0);
          setIncludePayroll(false);
          setIncludeBookkeeping(false);
          setIncludeSingleSA(false);
          setVatMonthly(false);
        }
      },[dormant]);

      return {
        step,setStep,
        who,setWho,companyType,setCompanyType,tierKey,setTierKey,
        isTrades,setIsTrades,dormant,setDormant,yearEnd,setYearEnd,
        employees,setEmployees,spvProperties,setSpvProperties,personalProperties,setPersonalProperties,
        includePayroll,setIncludePayroll,includeBookkeeping,setIncludeBookkeeping,includeSingleSA,setIncludeSingleSA,vatMonthly,setVatMonthly,
        saSoleBusiness,setSaSoleBusiness,saNonBusiness,setSaNonBusiness,additionalDirectorSAs,setAdditionalDirectorSAs,
        isCISContractor,setIsCISContractor,isCISSubcontractor,setIsCISSubcontractor,cisMonthlyReturns,setCisMonthlyReturns,cisSubbies,setCisSubbies,trackCISStatements,setTrackCISStatements,cisVerification,setCisVerification,
        ihtReview,setIhtReview,p11d,setP11d,p11dEmployees,setP11dEmployees,dividendPack,setDividendPack,hmrcLetter,setHmrcLetter,coHouseChanges,setCoHouseChanges,
        faPayOptimiser,setFaPayOptimiser,faTrusts,setFaTrusts,faInvestment,setFaInvestment
      };
    }

    // Helpers
    function monthsSince(dateStr){
      if(!dateStr) return 0;
      const d = new Date(dateStr);
      const now = new Date();
      let months = (now.getFullYear()-d.getFullYear())*12 + (now.getMonth()-d.getMonth());
      if (now.getDate() < d.getDate()) months -= 1; // crude but fine
      return Math.max(0, months);
    }

    function calcPricing(s){
      const tier = REVENUE_TIERS.find(t=>t.key===s.tierKey) || REVENUE_TIERS[0];
      const m = tier.multiplier;

      const monthly=[], oneoff=[];

      // MONTHLY (skip completely if dormant Ltd)
      const allowMonthly = !(s.who==="limited" && s.dormant);

      if(allowMonthly){
        if(s.who==="limited"){
          let pkg = 90*m;

          if(!s.includePayroll)      pkg -= 10;
          if(!s.includeBookkeeping)  pkg -= 20;
          if(!s.includeSingleSA)     pkg -= 10; // £10 pm reduction
          pkg = Math.max(pkg, 55*m);

          // Payroll add-on beyond 2 employees
          if(s.includePayroll){
            const extra = Math.max(0, s.employees - 2) * 6;
            if(extra>0) monthly.push({label:"Payroll add-on (over 2 employees)",amount:extra});
          }

          const notes=[
            "Year-end accounts & CT600",
            s.includeSingleSA?"1 director Self Assessment (included)":"Single director SA removed (−£10pm)",
            s.includePayroll?"Payroll for 1–2 staff included":"Payroll removed",
            "Confirmation statement filing (SBX absorbs £34 fee)",
            "QuickBooks subscription included",
            s.includeBookkeeping?"Full bookkeeping included":"Bookkeeping removed"
          ].join(" · ");

          monthly.push({label:"Standard Company Package",note:notes+" · Price may reduce depending on services selected.",amount:pkg});

          if(s.companyType==="property" && s.spvProperties>0){
            const base=(55 + Math.max(0,s.spvProperties-1)*5)*m;
            monthly.push({label:"Property Company Package",note:`${s.spvProperties} propert${s.spvProperties>1?"ies":"y"}`,amount:base});
          }

          // VAT monthly option when tier ≤ £90k
          if(REVENUE_TIERS.findIndex(t=>t.key===s.tierKey)<=1 && s.vatMonthly){
            monthly.push({label:"VAT Returns (averaged monthly)",amount:20});
          }

        } else if(s.who==="partnership"){
          let base=80*m;
          monthly.push({label:"Partnership Package",note:"QuickBooks + bookkeeping + quarterly reviews",amount:base});
          if(REVENUE_TIERS.findIndex(t=>t.key===s.tierKey)<=1 && s.vatMonthly) monthly.push({label:"VAT Returns (averaged monthly)",amount:20});
          if(s.includePayroll && s.employees>0){
            const extra = Math.max(0, s.employees - 0) * 10; // simple add-on for any staff
            if(extra>0) monthly.push({label:"Payroll add-on",amount:extra});
          }
        } else if(s.who==="sole"){
          let base=60*m;
          monthly.push({label:"Sole Trader Bookkeeping Package",note:"QuickBooks + bookkeeping + quarterly reviews",amount:base});
          if(REVENUE_TIERS.findIndex(t=>t.key===s.tierKey)<=1 && s.vatMonthly) monthly.push({label:"VAT Returns (averaged monthly)",amount:20});
          if(s.includePayroll && s.employees>0){
            const extra = Math.max(0, s.employees - 0) * 10;
            if(extra>0) monthly.push({label:"Payroll add-on",amount:extra});
          }
        }

        // CIS (Contractor monthly returns)
        if(s.isTrades && s.isCISContractor && s.cisMonthlyReturns){
          const extra = Math.max(0, s.cisSubbies - 5) * 2;
          monthly.push({label:"CIS Monthly Returns (contractor)",note:`Includes up to 5 subbies${extra>0?`, +£2 per extra (${s.cisSubbies})`:''}`,amount:20+extra});
        }
      }

      // ONE-OFFS

      // Company formation (if ever needed) – fee free with monthly; £50 CH always recharged (but only if forming)
      // (Not adding a toggle for formation per your latest brief)

      // Dormant pack
      if(s.who==="limited" && s.dormant){
        oneoff.push({label:"Dormant Accounts & Confirmation Statement",amount:120});
      }

      // Bookkeeping catch-up (beyond free 4 months) — Ltd only, not dormant
      if(s.who==="limited" && !s.dormant && s.yearEnd){
        const months = monthsSince(s.yearEnd);
        const billable = Math.max(0, months - 4);
        if(billable>0){
          const rate = (s.companyType==="property")? 30 : 40; // tweakable
          oneoff.push({label:`Bookkeeping catch-up (beyond 4 months free) — ${billable} month${billable>1?'s':''}`,amount: billable*rate});
        }
      }

      // Self Assessments
      if(s.who==="sole" && s.saSoleBusiness){
        let sa=200; if(s.tierKey==="30_90") sa=230; if(s.tierKey==="90_150") sa=270; if(s.tierKey==="150_250") sa=320; if(s.tierKey==="250p") sa=370;
        // landlord properties increase even if running a sole-trader business (if relevant)
        const propExtra = Math.max(0, s.personalProperties) * 20;
        oneoff.push({label:"Self-Assessment (sole trader business)",note:`${REVENUE_TIERS.find(t=>t.key===s.tierKey).label}${s.personalProperties>0?` · +${s.personalProperties} rental propert${s.personalProperties>1?'ies':'y'}`:''}`,amount:sa + propExtra});
      }
      if(s.who==="sole" && s.saNonBusiness){
        const base = 150 + Math.max(0, s.personalProperties) * 20;
        oneoff.push({label:"Self-Assessment (no business / landlord)",note:`Includes rental schedules (${s.personalProperties})`,amount:base});
      }

      // Additional director SAs (Ltd)
      if(s.who==="limited" && s.additionalDirectorSAs>0){
        const pricePer = 180; // your usual business SA (after the main one is included); adjust as needed
        oneoff.push({label:`Additional directors (Self Assessment) ×${s.additionalDirectorSAs}`,amount: pricePer * s.additionalDirectorSAs});
      }

      // CIS free items (shown for transparency if selected)
      if(s.isTrades && s.isCISContractor && s.cisVerification){
        oneoff.push({label:"CIS contractor verification/setup",note:"Free",amount:0});
      }
      if(s.isTrades && s.isCISSubcontractor && s.trackCISStatements){
        oneoff.push({label:"CIS statements tracking (subcontractor)",note:"Free",amount:0});
      }

      // Specialist one-offs (no registrations charged)
      if(s.ihtReview)    oneoff.push({label:"IHT Initial Review & Recommendations",amount:250});
      if(s.dividendPack) oneoff.push({label:"Dividend Declaration Pack (minutes, vouchers, board resolutions)",amount:30});
      if(s.hmrcLetter)   oneoff.push({label:"HMRC letter/appeal drafting",amount:75});
      if(s.coHouseChanges) oneoff.push({label:"Companies House changes (officer/address/PSC)",amount:25});
      if(s.p11d)         oneoff.push({label:`P11D preparation ×${s.p11dEmployees}`,amount:30*s.p11dEmployees});

      // Advisory
      if(s.faPayOptimiser) oneoff.push({label:"Director’s Pay Optimiser (tailored summary)",note:"Free",amount:0});
      if(s.faTrusts)       oneoff.push({label:"Trusts & Family Investment Structures – initial consult",amount:150});
      if(s.faInvestment)   oneoff.push({label:"Investment tax strategy review (ISAs, pensions, GIA/CGT planning)",amount:150});

      // Clean & totals
      const cleanMonthly=monthly.filter(l=>l.amount>0 || (l.amount===0 && l.note));
      const cleanOneOff =oneoff.filter(l=>l.amount>0 || (l.amount===0 && l.note));
      const monthlyTotal=cleanMonthly.reduce((a,b)=>a+(b.amount||0),0);
      const oneOffTotal =cleanOneOff.reduce((a,b)=>a+(b.amount||0),0);
      return {monthly:cleanMonthly,oneoff:cleanOneOff,monthlyTotal,oneOffTotal};
    }

    // Snake grid: desktop 2 columns, pair rows alternate; mobile single column natural order
    function SnakeGrid({sections}) {
      const isDesktop = useIsDesktop();
      if(!isDesktop){
        // arrows: always down except last
        return (
          <div className="grid grid-cols-1 gap-6">
            {sections.map((s,i)=>(
              <div key={s.key}>
                <Section stepLabel={s.step} arrowDir={ i < sections.length-1 ? "down" : "" } title={s.title} subtitle={s.subtitle}>
                  {s.content}
                </Section>
              </div>
            ))}
          </div>
        );
      }
      // Desktop snake ordering (visual path)
      const ordered=[];
      for(let i=0,row=0;i<sections.length;i+=2,row++){
        const pair = sections.slice(i,i+2);
        if(pair.length===2 && row%2===1) pair.reverse();
        ordered.push(...pair);
      }
      // compute arrow directions relative to grid positions
      const arrowFor = (idx) => {
        if(idx===ordered.length-1) return "";
        const col = idx%2, nextCol = (idx+1)%2;
        const row = Math.floor(idx/2), nextRow = Math.floor((idx+1)/2);
        if(nextRow>row && nextCol===col) return "down";
        if(nextRow===row && nextCol>col) return "right";
        if(nextRow===row && nextCol<col) return "left";
        if(nextRow>row && nextCol!==col) return "down"; // fallback
        return "down";
      };
      return (
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          {ordered.map((s,i)=>(
            <div key={s.key}>
              <Section stepLabel={s.step} arrowDir={arrowFor(i)} title={s.title} subtitle={s.subtitle}>
                {s.content}
              </Section>
            </div>
          ))}
        </div>
      );
    }

    function InputsSnake({ s, onNext }) {
      const tierIdx = REVENUE_TIERS.findIndex(t=>t.key===s.tierKey);
      const canShowVAT = tierIdx<=1;

      // Sections in natural order (1 → 2 → CIS (if any) → 3 → 4 → 5 → 6)
      const sections = [];

      // Step 1
      sections.push({
        key:"st1",
        step:"1",
        title:"Who is this for?",
        subtitle:"",
        content:(
          <div className="grid gap-3">
            <label className={`flex items-center gap-3 p-3 border rounded-xl cursor-pointer ${s.who==="limited"?"border-[var(--sbx-blue)] bg-blue-50/40":"border-slate-200"}`}>
              <input type="radio" name="who" checked={s.who==="limited"} onChange={()=>s.setWho("limited")} />
              <div className="font-medium">Limited company</div>
            </label>
            <label className={`flex items-center gap-3 p-3 border rounded-xl cursor-pointer ${s.who==="partnership"?"border-[var(--sbx-blue)] bg-blue-50/40":"border-slate-200"}`}>
              <input type="radio" name="who" checked={s.who==="partnership"} onChange={()=>s.setWho("partnership")} />
              <div className="font-medium">Partnership</div>
            </label>
            <label className={`flex items-center gap-3 p-3 border rounded-xl cursor-pointer ${s.who==="sole"?"border-[var(--sbx-blue)] bg-blue-50/40":"border-slate-200"}`}>
              <input type="radio" name="who" checked={s.who==="sole"} onChange={()=>s.setWho("sole")} />
              <div className="font-medium">Individual / Sole trader / Landlord</div>
            </label>
          </div>
        )
      });

      // Step 2
      sections.push({
        key:"st2",
        step:"2",
        title:"Business profile",
        subtitle:"Company type, trades, year end, and properties where relevant",
        content:(
          <>
            {s.who==="limited" && (
              <div className="grid gap-3 mb-4">
                <label className={`flex items-center gap-3 p-3 border rounded-xl cursor-pointer ${s.companyType==="standard"?"border-[var(--sbx-blue)] bg-blue-50/40":"border-slate-200"}`}>
                  <input type="radio" name="coType" checked={s.companyType==="standard"} onChange={()=>s.setCompanyType("standard")}/>
                  <div>
                    <div className="font-medium">Standard Limited Company</div>
                    <p className="text-sm text-[var(--sbx-mute)] mt-1">
                      Our standard company package is <strong>£90pm</strong> and includes <em>year-end accounts & CT return, single director Self Assessment, payroll for 1–2 staff, confirmation statement filing (we absorb the £34 fee), QuickBooks subscription, and full bookkeeping</em>. Price can be reduced depending on services required.
                    </p>
                  </div>
                </label>
                <label className={`flex items-center gap-3 p-3 border rounded-xl cursor-pointer ${s.companyType==="property"?"border-[var(--sbx-blue)] bg-blue-50/40":"border-slate-200"}`}>
                  <input type="radio" name="coType" checked={s.companyType==="property"} onChange={()=>s.setCompanyType("property")}/>
                  <div className="font-medium">Property Investment Company (SPV)</div>
                </label>
              </div>
            )}

            <div className="grid md:grid-cols-2 gap-4">
              {s.who==="limited" && (
                <>
                  <div className="flex items-center gap-2">
                    <input id="dormant" type="checkbox" checked={s.dormant} onChange={e=>s.setDormant(e.target.checked)} />
                    <label htmlFor="dormant" className="text-sm">Company is dormant / not trading</label>
                  </div>

                  <div>
                    <label className="block text-sm mb-1">Company year end date</label>
                    <input type="date" value={s.yearEnd} onChange={e=>s.setYearEnd(e.target.value)} className="w-full border rounded-xl px-3 py-2"/>
                    <p className="text-xs text-[var(--sbx-mute)] mt-1">Used to calculate bookkeeping catch-up beyond 4 months free.</p>
                  </div>
                </>
              )}

              <div className="flex items-center gap-2">
                <input id="trades" type="checkbox" checked={s.isTrades} onChange={e=>s.setIsTrades(e.target.checked)} />
                <label htmlFor="trades" className="text-sm">Trades / construction business</label>
              </div>

              {s.who==="limited" && s.companyType==="property" && (
                <div>
                  <label className="block text-sm mb-1">Number of properties in company (SPV)</label>
                  <input type="number" min="0" value={s.spvProperties} onChange={e=>s.setSpvProperties(Number(e.target.value)||0)} className="w-full border rounded-xl px-3 py-2"/>
                </div>
              )}

              {s.who==="sole" && (
                <div>
                  <label className="block text-sm mb-1">Personal rental properties</label>
                  <input type="number" min="0" value={s.personalProperties} onChange={e=>s.setPersonalProperties(Number(e.target.value)||0)} className="w-full border rounded-xl px-3 py-2"/>
                </div>
              )}
            </div>

            {s.who==="limited" && (
              <div className="text-xs text-[var(--sbx-mute)] mt-3">
                New Ltd Co signup: <strong>4 months of backdated bookkeeping free.</strong>
              </div>
            )}
          </>
        )
      });

      // Step 2a — CIS (immediately after Step 2 when trades is ticked)
      if(s.isTrades){
        sections.push({
          key:"st2cis",
          step:"2a",
          title:"CIS options",
          subtitle:"Contractors vs Subcontractors",
          content:(
            <div className="grid md:grid-cols-2 gap-4">
              <div className="p-3 border rounded-xl">
                <p className="font-medium mb-2">Contractor</p>
                <label className="flex items-center gap-3 text-sm mb-2">
                  <input type="checkbox" checked={s.isCISContractor} onChange={e=>s.setIsCISContractor(e.target.checked)}/> I’m a CIS contractor
                </label>
                {s.isCISContractor && (
                  <>
                    <label className="flex items-center gap-3 text-sm mb-2">
                      <input type="checkbox" checked={s.cisMonthlyReturns} onChange={e=>s.setCisMonthlyReturns(e.target.checked)}/> CIS monthly returns
                    </label>
                    <div className="flex items-center gap-2 text-sm mb-2">
                      <span>Subcontractors:</span>
                      <input type="number" min="0" value={s.cisSubbies} onChange={e=>s.setCisSubbies(Number(e.target.value)||0)} className="w-28 border rounded-xl px-3 py-2"/>
                    </div>
                    <div className="text-xs text-[var(--sbx-mute)]">CIS contractor verification/setup: <strong>free</strong></div>
                  </>
                )}
              </div>
              <div className="p-3 border rounded-xl">
                <p className="font-medium mb-2">Subcontractor</p>
                <label className="flex items-center gap-3 text-sm mb-2">
                  <input type="checkbox" checked={s.isCISSubcontractor} onChange={e=>s.setIsCISSubcontractor(e.target.checked)}/> I’m a CIS subcontractor
                </label>
                {s.isCISSubcontractor && (
                  <label className="flex items-center gap-3 text-sm">
                    <input type="checkbox" checked={s.trackCISStatements} onChange={e=>s.setTrackCISStatements(e.target.checked)}/> Track my CIS deduction statements (free)
                  </label>
                )}
              </div>
            </div>
          )
        });
      }

      // Step 3
      sections.push({
        key:"st3",
        step:"3",
        title:"Revenue band",
        subtitle:"",
        content:(
          <div className="grid md:grid-cols-3 gap-3">
            {REVENUE_TIERS.map(t=>(
              <label key={t.key} className={`flex items-center gap-3 p-3 border rounded-xl cursor-pointer ${s.tierKey===t.key?"border-[var(--sbx-blue)] bg-blue-50/40":"border-slate-200"}`}>
                <input type="radio" name="tier" checked={s.tierKey===t.key} onChange={()=>s.setTierKey(t.key)}/>
                <div className="font-medium">{t.label}</div>
              </label>
            ))}
            {REVENUE_TIERS.findIndex(t=>t.key===s.tierKey)>=2 && (
              <div className="col-span-full text-xs text-[var(--sbx-mute)]">Over £90k – VAT registration is typically required (we’ll hide the monthly VAT option).</div>
            )}
          </div>
        )
      });

      // Step 4
      sections.push({
        key:"st4",
        step:"4",
        title:"What’s included / adjustments",
        subtitle:"Reduce or tailor your package below",
        content:(
          <div className="grid md:grid-cols-2 gap-6">
            <div className="space-y-3">
              {s.who!=="sole" && (
                <label className="flex items-start gap-3 text-sm">
                  <input type="checkbox" checked={s.includeBookkeeping} onChange={e=>s.setIncludeBookkeeping(e.target.checked)} />
                  <span><span className="font-medium">Full bookkeeping</span><br/><span className="text-[var(--sbx-mute)]">Remove if you keep books in-house.</span></span>
                </label>
              )}
              {s.who!=="sole" && (
                <label className="flex items-start gap-3 text-sm">
                  <input type="checkbox" checked={s.includePayroll} onChange={e=>s.setIncludePayroll(e.target.checked)} />
                  <span><span className="font-medium">Payroll for 1–2 staff included</span><br/><span className="text-[var(--sbx-mute)]">Employees beyond 2 add a small monthly fee.</span></span>
                </label>
              )}
              {s.who==="limited" && (
                <label className="flex items-start gap-3 text-sm">
                  <input type="checkbox" checked={s.includeSingleSA} onChange={e=>s.setIncludeSingleSA(e.target.checked)} />
                  <span><span className="font-medium">Single director Self Assessment</span><br/><span className="text-[var(--sbx-mute)]">Remove to reduce price (−£10 pm).</span></span>
                </label>
              )}

              { (REVENUE_TIERS.findIndex(t=>t.key===s.tierKey)<=1) && (
                <label className="flex items-start gap-3 text-sm">
                  <input type="checkbox" checked={s.vatMonthly} onChange={e=>s.setVatMonthly(e.target.checked)} />
                  <span><span className="font-medium">VAT returns (averaged monthly)</span></span>
                </label>
              )}
            </div>

            <div className="space-y-3">
              <div>
                <label className="block text-sm mb-1">Employees on payroll (incl directors)</label>
                <input type="number" min="0" value={s.employees} onChange={e=>s.setEmployees(Number(e.target.value)||0)} className="w-full border rounded-xl px-3 py-2"/>
              </div>
              {s.who==="limited" && (
                <div className="flex items-center gap-2 text-sm">
                  <span>Additional directors (Self Assessment):</span>
                  <input type="number" min="0" value={s.additionalDirectorSAs} onChange={e=>s.setAdditionalDirectorSAs(Number(e.target.value)||0)} className="w-28 border rounded-xl px-3 py-2"/>
                </div>
              )}
              {s.who==="sole" && (
                <>
                  <label className="flex items-center gap-3 text-sm"><input type="checkbox" checked={s.saSoleBusiness} onChange={e=>s.setSaSoleBusiness(e.target.checked)}/> Sole trader business SA (tiered by revenue)</label>
                  <label className="flex items-center gap-3 text-sm"><input type="checkbox" checked={s.saNonBusiness} onChange={e=>s.setSaNonBusiness(e.target.checked)}/> No-business/landlord SA (base + per-property)</label>
                </>
              )}
            </div>
          </div>
        )
      });

      // Step 5
      sections.push({
        key:"st5",
        step:"5",
        title:"Specialist one-off items",
        subtitle:"We don’t charge for tax registrations; choose any add-ons here",
        content:(
          <div className="grid md:grid-cols-2 gap-3">
            <label className="flex items-center gap-3 text-sm"><input type="checkbox" checked={s.ihtReview} onChange={e=>s.setIhtReview(e.target.checked)}/> IHT review (£250)</label>
            <label className="flex items-center gap-3 text-sm"><input type="checkbox" checked={s.dividendPack} onChange={e=>s.setDividendPack(e.target.checked)}/> Dividend declaration pack (£30)</label>
            <label className="flex items-center gap-3 text-sm"><input type="checkbox" checked={s.hmrcLetter} onChange={e=>s.setHmrcLetter(e.target.checked)}/> HMRC letter/appeal drafting (£75)</label>
            <label className="flex items-center gap-3 text-sm"><input type="checkbox" checked={s.coHouseChanges} onChange={e=>s.setCoHouseChanges(e.target.checked)}/> Companies House changes (£25)</label>
            <div className="flex items-center gap-2 text-sm">
              <input type="checkbox" checked={s.p11d} onChange={e=>s.setP11d(e.target.checked)}/>
              <span>P11D per employee (£30)</span>
              {s.p11d && (<><span className="ml-2">Qty:</span><input type="number" min="1" value={s.p11dEmployees} onChange={e=>s.setP11dEmployees(Number(e.target.value)||1)} className="w-20 border rounded-xl px-3 py-2"/></>)}
            </div>
          </div>
        )
      });

      // Step 6
      sections.push({
        key:"st6",
        step:"6",
        title:"Financial advisory",
        subtitle:"Pick what you’d like to discuss — or email us to book a consultation",
        content:(
          <div className="grid md:grid-cols-2 gap-3">
            <label className="flex items-center gap-3 text-sm"><input type="checkbox" checked={s.faPayOptimiser} onChange={e=>s.setFaPayOptimiser(e.target.checked)}/> Director’s Pay Optimiser (free)</label>
            <label className="flex items-center gap-3 text-sm"><input type="checkbox" checked={s.faTrusts} onChange={e=>s.setFaTrusts(e.target.checked)}/> Trusts & family investment structures consult (£150)</label>
            <label className="flex items-center gap-3 text-sm"><input type="checkbox" checked={s.faInvestment} onChange={e=>s.setFaInvestment(e.target.checked)}/> Investment tax strategy review (£150)</label>

            <a className="inline-block mt-2 px-4 py-2 rounded-xl bg-[var(--sbx-blue)] text-white text-sm font-semibold"
               href="mailto:ryan@sbxaccountants.com?subject=SBX%20Consultation%20Request&body=Hi%20SBX%2C%0A%0AI%27d%20like%20to%20book%20a%20consultation%20to%20discuss%20my%20quote%20and%20requirements.%0A%0AThanks%2C%0A"
               >Email Ryan to book a consultation</a>
          </div>
        )
      });

      return (
        <>
          <SnakeGrid sections={sections} />
          <div className="no-print flex justify-end mt-6">
            <button className="px-5 py-2 rounded-xl bg-[var(--sbx-blue)] text-white font-semibold" onClick={onNext}>Get Quote</button>
          </div>
        </>
      );
    }

    function Quote({s,onBack}){
      const q = calcPricing(s);
      const printQuote = ()=>window.print();

      return (
        <div className="print-area">
          <div className="card p-6 mb-6">
            <div className="mb-2">
              <h2 className="text-xl font-semibold text-[var(--sbx-blue)]">Your Quote</h2>
              <p className="text-sm text-[var(--sbx-mute)]">Only relevant items are shown. No VAT is added.</p>
            </div>

            <div className="grid lg:grid-cols-2 gap-6">
              <div>
                <h3 className="text-lg font-semibold mb-2">Monthly</h3>
                {q.monthly.length===0?(
                  <p className="text-sm text-[var(--sbx-mute)]">No monthly items selected.</p>
                ):(
                  <ul className="space-y-2">
                    {q.monthly.map((l,i)=>(
                      <li key={i} className="flex items-start justify-between gap-4 border-b pb-2">
                        <div>
                          <p className="font-medium">{l.label}</p>
                          {l.note && <p className="text-xs text-[var(--sbx-mute)] mt-0.5">{l.note}</p>}
                        </div>
                        <div className="font-semibold">{currency(l.amount)}/mo</div>
                      </li>
                    ))}
                    <li className="flex items-start justify-between gap-4 pt-2">
                      <div className="font-semibold">Monthly Total</div>
                      <div className="font-semibold">{currency(q.monthlyTotal)}/mo</div>
                    </li>
                  </ul>
                )}
              </div>

              <div>
                <h3 className="text-lg font-semibold mb-2">One-off</h3>
                {q.oneoff.length===0?(
                  <p className="text-sm text-[var(--sbx-mute)]">No one-off items selected.</p>
                ):(
                  <ul className="space-y-2">
                    {q.oneoff.map((l,i)=>(
                      <li key={i} className="flex items-start justify-between gap-4 border-b pb-2">
                        <div>
                          <p className="font-medium">{l.label}</p>
                          {l.note && <p className="text-xs text-[var(--sbx-mute)] mt-0.5">{l.note}</p>}
                        </div>
                        <div className="font-semibold">{currency(l.amount)}</div>
                      </li>
                    ))}
                    <li className="flex items-start justify-between gap-4 pt-2">
                      <div className="font-semibold">One-off Total</div>
                      <div className="font-semibold">{currency(q.oneOffTotal)}</div>
                    </li>
                  </ul>
                )}
              </div>
            </div>

            <div className="mt-4 text-xs text-[var(--sbx-mute)]">
              <ul className="list-disc ml-5 space-y-1">
                <li>Company formation is free with monthly company packages; the £50 Companies House fee is recharged at cost.</li>
                <li>New company signups receive up to 4 months of backdated bookkeeping free.</li>
              </ul>
            </div>
          </div>

          <div className="no-print flex items-center justify-between gap-3">
            <div className="text-sm text-[var(--sbx-mute)]">Brand: <span className="text-[var(--sbx-blue)] font-semibold">SBX Accountants</span></div>
            <div className="flex gap-3">
              <button className="px-5 py-2 rounded-xl border font-semibold" onClick={onBack}>Back</button>
              <button className="px-5 py-2 rounded-xl bg-[var(--sbx-blue)] text-white font-semibold" onClick={printQuote}>Print</button>
            </div>
          </div>
        </div>
      );
    }

    function App(){
      const s = useQuoteState();
      return (
        <div className="max-w-6xl mx-auto px-4 py-6">
          <header className="no-print mb-6">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-xl bg-[var(--sbx-blue)] text-white font-bold flex items-center justify-center">SBX</div>
                <div>
                  <h1 className="text-2xl md:text-3xl font-semibold text-[var(--sbx-blue)]">SBX Quote Builder</h1>
                  <p className="text-sm text-[var(--sbx-mute)]">Two quick steps. Clear, no-VAT pricing.</p>
                </div>
              </div>
              <span className="text-xs px-2 py-1 rounded-full bg-blue-50 text-[var(--sbx-blue)]">Step {s.step} of 2</span>
            </div>
          </header>

          {s.step===1 ? <InputsSnake s={s} onNext={()=>s.setStep(2)} /> : <Quote s={s} onBack={()=>s.setStep(1)} />}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App/>);
  </script>
</body>
</html>
